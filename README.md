# Buy01 - E-commerce Microservices Platform

![Database Design](Database-Design.png)

## üìã Table des Mati√®res
- [Vue d'ensemble](#vue-densemble)
- [Architecture](#architecture)
- [Technologies Utilis√©es](#technologies-utilis√©es)
- [Pr√©requis](#pr√©requis)
- [Installation et D√©marrage](#installation-et-d√©marrage)
- [Configuration](#configuration)
- [Documentation API](#documentation-api)
- [S√©curit√©](#s√©curit√©)
- [Tests](#tests)
- [D√©pannage](#d√©pannage)
- [Variables d'environnement](#variables-denvironnement)
- [Frontend (Angular)](#frontend-angular)

## üéØ Vue d'ensemble

Buy01 est une plateforme e-commerce compl√®te construite avec une architecture microservices utilisant Spring Boot et Angular. La plateforme permet :

- **Inscription utilisateur** : Clients et Vendeurs avec upload d'avatar pour les vendeurs (max 2MB)
- **Authentification s√©curis√©e** : JWT avec gestion des r√¥les et tokens internes
- **Gestion des produits** : CRUD exclusif aux vendeurs authentifi√©s
- **Gestion des m√©dias** : Upload d'images avec validation (JPEG, PNG, WebP - max 2MB)
- **Communication inter-services** : Apache Kafka pour l'√©v√©nementiel
- **Interface utilisateur** : Dashboard Angular responsive

## üèóÔ∏è Architecture

### Microservices et Ports
```
üì¶ Buy01 Architecture
‚îú‚îÄ‚îÄ üîç Discovery Server (Eureka)     - Port 8761
‚îú‚îÄ‚îÄ üö™ Gateway Service (HTTPS)       - Port 8443
‚îú‚îÄ‚îÄ üë• User Service                  - Port 8081
‚îú‚îÄ‚îÄ üì¶ Product Service               - Port 8082
‚îú‚îÄ‚îÄ üñºÔ∏è Media Service                 - Port 8083
‚îú‚îÄ‚îÄ üåê Frontend (Angular)            - Port 4200
‚îú‚îÄ‚îÄ üìä MongoDB User DB               - Port 27017 (user_db)
‚îú‚îÄ‚îÄ üìä MongoDB Product DB            - Port 27018 (product_db)
‚îú‚îÄ‚îÄ üìä MongoDB Media DB              - Port 27019 (media_db)
‚îú‚îÄ‚îÄ üîÑ Kafka Broker                  - Port 9092
‚îî‚îÄ‚îÄ üêò Zookeeper                     - Port 2181
```

### Communication
- **Service Discovery** : Netflix Eureka (Spring Cloud 2025.0.0)
- **API Gateway** : Spring Cloud Gateway avec SSL/HTTPS
- **Message Broker** : Apache Kafka 7.5.3 pour les √©v√©nements inter-services
- **Base de donn√©es** : MongoDB s√©par√©e par service
- **Authentification** : JWT + tokens internes pour communication service-√†-service

## üõ†Ô∏è Technologies Utilis√©es

### Backend
- **Spring Boot 3.5.3** (Java 17)
- **Spring Cloud 2025.0.0** (Eureka Client, Gateway)
- **Spring Security** + JWT (jjwt 0.11.5)
- **Spring Data MongoDB**
- **Apache Kafka** avec Zookeeper
- **Springdoc OpenAPI 2.7.0** (Swagger)
- **Bucket4j 7.6.0** (Rate Limiting)
- **Spring Validation**
- **Docker & Docker Compose**

### Infrastructure
- **MongoDB** (derni√®re version)
- **Confluent Kafka & Zookeeper**
- **SSL/HTTPS** avec certificats PKCS12

## üìã Pr√©requis

- **Docker** et **Docker Compose**
- **Java 17** (pour d√©veloppement local)
- **Maven 3.6+** (pour build des services)
- **mkcert** (pour certificats SSL en d√©veloppement)
- **Node.js** (LTS version, e.g., 18.x or 20.x)
- **npm** (Node Package Manager, usually comes with Node.js)
- **Angular CLI** (`npm install -g @angular/cli`)

## üöÄ Installation et D√©marrage


 **Cloner le repository**
```bash
git clone https://learn.zone01dakar.sn/git/preydedy/buy-01.git
cd buy01
```

### Option 1 : D√©marrage avec Docker via script sh (Rapide)

1. **Modifier les droits d'ex√©cutions des fichiers scripts**
```bash
chmod +x commit.sh run_microservice.sh start-project.sh stop-project.sh toggle-config.sh run-all-tests.sh
```

2. **Pour lancer le projet**
```bash
./start-project.sh
```

3. **Pour arr√™ter le projet**
```bash
./stop-project.sh
```

### Option 2 : D√©marrage avec Docker manuel (Recommand√©)

1. **Construire et d√©marrer tous les services**
```bash
docker-compose up --build
```

2. **V√©rifier le d√©marrage des services**
```bash
# Eureka Dashboard
http://localhost:8761

# Gateway (HTTPS uniquement)
https://localhost:8443

# Documentation API centralis√©e
https://localhost:8443/swagger-ui.html
```

3. **D√©marrer le frontend Angular**
```bash
cd frontend
npm install
npm run compodoc:serve
npm start
```

### Option 3 : D√©marrage manuel (D√©veloppement)

**D√©marrer les services Spring Boot via le Script**

```bash
./run_microservice.sh
```

## ‚öôÔ∏è Configuration

### Configuration SSL/HTTPS

Le projet utilise **HTTPS obligatoire** via le Gateway Service. Le certificat est au format PKCS12.

#### G√©n√©ration de certificat pour d√©veloppement local

1. **Installer mkcert**
```bash
# Ubuntu/Debian
sudo apt install libnss3-tools mkcert

# macOS
brew install mkcert
```

2. **Cr√©er et installer le certificat**
```bash
# Cr√©er le certificat pour localhost
mkcert localhost

# Convertir en PKCS12
openssl pkcs12 -export \
  -in localhost.pem \
  -inkey localhost-key.pem \
  -out keystore.p12 \
  -name springboot \
  -password pass:changeit

# D√©placer dans les ressources du Gateway
mv keystore.p12 backend/api/gateway-service/src/main/resources/
```

### Bases de donn√©es MongoDB

Chaque service a sa propre base de donn√©es :

| Service | Database | Port | Container |
|---------|----------|------|-----------|
| User Service | `user_db` | 27017 | `user-mongodb` |
| Product Service | `product_db` | 27018 | `product-mongodb` |
| Media Service | `media_db` | 27019 | `media-mongodb` |

**Credentials** : `root` / `secret`

### Configuration Kafka

- **Bootstrap Servers** : `kafka:29092` (interne) / `localhost:9092` (externe)
- **Topics** : Auto-cr√©ation activ√©e
- **Consumer Groups** : 
  - `user-service-group`
  - `product-service-group` 
  - `media-service-group`

## üìö Documentation API & Frontend(Angular)

### Swagger UI Centralis√©
- **Gateway Swagger** : https://localhost:8443/swagger-ui.html
- Agr√®ge tous les services : User, Product, Media

### Swagger par service (d√©veloppement)
- **User Service** : http://localhost:8081/swagger-ui.html
- **Product Service** : http://localhost:8082/swagger-ui.html  
- **Media Service** : http://localhost:8083/swagger-ui.html

### Generate and serve frontend documentation  with hot-reload:
```bash
cd frontend
npm install
npm run compodoc:serve
```
#### After it, You'll able to see frontend doc on this link:


[http://localhost:8080/](http://localhost:8080/)


### Routes Gateway principales

| Route | Service de destination | Description |
|-------|----------------------|-------------|
| `/api/auth/**` | user-service | Authentification (avec rate limiting) |
| `/api/users/**` | user-service | Gestion utilisateurs |
| `/api/admin/**` | user-service | Administration |
| `/avatars/**` | user-service | Images avatars |
| `/api/products/**` | product-service | CRUD produits |
| `/api/media/**` | media-service | Upload/gestion m√©dias |
| `/productsImages/**` | media-service | Images produits |

### Endpoints principaux

#### User Service (Port 8081)
```bash
POST   /api/auth/register     # Inscription (CLIENT/SELLER)
POST   /api/auth/login        # Connexion (retourne JWT)
GET    /api/users/me          # Profil utilisateur connect√©
PUT    /api/users/me          # Mise √† jour profil
POST   /api/users/avatar      # Upload avatar (SELLER)
GET    /avatars/{filename}    # R√©cup√©rer avatar
```

#### Product Service (Port 8082)
```bash
GET    /api/products          # Liste publique des produits
POST   /api/products          # Cr√©er produit (SELLER uniquement)
GET    /api/products/{id}     # D√©tail produit
PUT    /api/products/{id}     # Modifier produit (propri√©taire uniquement)
DELETE /api/products/{id}     # Supprimer produit (propri√©taire uniquement)
```

#### Media Service (Port 8083)
```bash
POST   /api/media/upload      # Upload image produit (max 2MB, JPEG/PNG/WebP)
GET    /api/media/{id}        # M√©tadonn√©es image
GET    /productsImages/{filename} # R√©cup√©rer image
DELETE /api/media/{id}        # Supprimer image (propri√©taire uniquement)
```

## üõ°Ô∏è S√©curit√©

### Mesures impl√©ment√©es

- **HTTPS Obligatoire** : Toutes les communications via SSL/TLS
- **JWT Authentication** : Tokens avec expiration (1 heure)
- **Role-Based Access Control** : CLIENT vs SELLER
- **Tokens internes** : Communication service-√†-service s√©curis√©e
- **Password Hashing** : Spring Security avec BCrypt
- **File Validation** : 
  - Types autoris√©s : `image/jpeg`, `image/png`, `image/webp`
  - Taille max : 2MB par fichier, 10MB par requ√™te
- **Rate Limiting** : Protection sur `/api/auth/**`
- **CORS Configuration** : Headers s√©curis√©s

### Configuration JWT
```yaml
jwt:
  secret: N5Dztk+QsQEOFEhZ9WZ7ZzRp7uuOoT/knKWvYVZLNS7vt8BjnfHxLjzjGdBfEBu3
  expiration: 3600000  # 1 heure en millisecondes
```

### Token interne (service-to-service)
```yaml
internal:
  token-header: X-INTERNAL-TOKEN
  token: NyKKbcadVWq1Mim/r7vwzPjy0SikZgFOiYJRO8GvE1A=
```

## üß™ Tests

### Tests automatis√©s
```bash
# User Service
cd backend/api/user && ./mvnw test

# Product Service  
cd backend/api/product && ./mvnw test

# Media Service
cd backend/api/media && ./mvnw test
```

### Tests manuels avec Swagger

1. **Authentification**
   - Inscription SELLER avec avatar
   - Login et r√©cup√©ration JWT
   - Test des acc√®s bas√©s sur les r√¥les

2. **Gestion produits**
   - Cr√©ation par SELLER uniquement
   - Modification par propri√©taire uniquement
   - Listing public accessible

3. **Upload m√©dias**
   - Validation taille (rejet > 2MB)
   - Validation type (rejet non-image)
   - Association avec produits

## üêõ D√©pannage

### Probl√®mes courants

#### Services ne d√©marrent pas
```bash
# V√©rifier les ports occup√©s
netstat -tulpn | grep -E ":(8761|8443|8081|8082|8083)"

# Nettoyer Docker compl√®tement
docker-compose down -v
docker system prune -af
docker volume prune -f
```

#### Probl√®mes MongoDB
```bash
# V√©rifier les logs MongoDB
docker logs user-mongodb
docker logs product-mongodb  
docker logs media-mongodb

# Acc√®s direct aux bases
docker exec -it user-mongodb mongosh -u root -p secret
```

#### Erreurs SSL/HTTPS
```bash
# V√©rifier le certificat
keytool -list -keystore backend/api/gateway-service/src/main/resources/keystore.p12 -storepass changeit

# R√©g√©n√©rer si n√©cessaire
rm backend/api/gateway-service/src/main/resources/keystore.p12
mkcert localhost
# Reconvertir...
```

#### Kafka non fonctionnel
```bash
# Red√©marrer l'infrastructure Kafka
docker-compose restart zookeeper kafka

# V√©rifier les topics
docker exec -it kafka kafka-topics --bootstrap-server localhost:9092 --list
```

#### Probl√®mes Eureka
```bash
# V√©rifier l'enregistrement des services
curl http://localhost:8761/eureka/apps

# Logs Discovery Server
docker logs discovery-server
```

### Logs utiles
```bash
# Tous les services
docker-compose logs -f

# Service sp√©cifique  
docker-compose logs -f user-service

# Suivre en temps r√©el
docker-compose logs -f --tail=100 gateway-service
```

## üîß Variables d'environnement

### Production
```env
# JWT
JWT_SECRET=votre-secret-jwt-tres-long-et-securise-minimum-256-bits

# MongoDB
MONGO_ROOT_PASSWORD=votre-mot-de-passe-securise

# Kafka
KAFKA_BOOTSTRAP_SERVERS=your-kafka-cluster:9092

# SSL
SSL_KEYSTORE_PASSWORD=votre-password-keystore

# Internal Services
INTERNAL_TOKEN=votre-token-interne-securise

# Eureka
EUREKA_DEFAULT_ZONE=http://your-eureka-server:8761/eureka
```

### D√©veloppement local
Les fichiers `application.properties` contiennent d√©j√† les configurations pour Docker Compose avec commentaires pour le d√©veloppement local.

## üìä Monitoring et Health Checks

### V√©rification des services
```bash
# Status des conteneurs
docker-compose ps

# Health check Eureka
curl http://localhost:8761/actuator/health

# Test Gateway
curl -k https://localhost:8443/actuator/health

# Services individuels  
curl http://localhost:8081/actuator/health # User
curl http://localhost:8082/actuator/health # Product
curl http://localhost:8083/actuator/health # Media
```

## ü§ù Contribution

1. Fork le projet
2. Cr√©ez votre branche feature (`git checkout -b feature/AmazingFeature`)
3. Committez vos changements (`git commit -m 'Add some AmazingFeature'`)
4. Push vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrez une Pull Request

## üìÑ License

Ce projet est sous licence MIT - voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

---

## üåê Frontend (Angular)

Le frontend de Buy01 est une application web r√©active construite avec Angular, offrant une interface utilisateur intuitive pour les clients et les vendeurs.

### Technologies Cl√©s
- **Angular** (derni√®re version stable)
- **TypeScript**
- **RxJS** pour la gestion des flux de donn√©es asynchrones
- **Angular Material** pour les composants UI (utilis√© pour `MatButtonToggleModule`, `MatIconModule`, `MatDialogModule`)
- **HTML5 & CSS3** (avec SCSS pour le style)

### Fonctionnalit√©s Principales
- **Authentification** : Inscription et connexion s√©curis√©es avec gestion des r√¥les (Client/Vendeur).
- **Gestion de Profil** : Les utilisateurs peuvent consulter et mettre √† jour leurs informations de profil, y compris l'avatar.
- **Liste de Produits** : Affichage des produits avec options de filtrage par cat√©gorie, recherche et tri (par nom, prix, date).
- **D√©tails du Produit** : Vue d√©taill√©e de chaque produit avec images, description et informations sur le vendeur.
- **Gestion des Produits (Vendeur)** : Les vendeurs peuvent ajouter, modifier et supprimer leurs propres produits, y compris la gestion des images associ√©es.
- **Notifications** : Syst√®me de messages (toasts) pour informer l'utilisateur des succ√®s et des erreurs.

### Structure du Projet Frontend
```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # Composants d'authentification (sign-in, sign-up)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ error/                # Composants de gestion d'erreurs (toast-error)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/               # Interfaces TypeScript pour les donn√©es (User, Product, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navbar/               # Composant de navigation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/             # Composants li√©s aux produits (list, card, circular-image)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/              # Composants de gestion de profil (profile, update-form)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seller/               # Composants sp√©cifiques aux vendeurs (dashboard, form-product, product-management)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/             # Services Angular pour l'interaction avec les APIs (auth, user, product, api-url, guard, data)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                # Fonctions utilitaires (handleHttpError)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.component.ts      # Composant racine de l'application
‚îÇ   ‚îú‚îÄ‚îÄ assets/                   # Fichiers statiques (images, ic√¥nes)
‚îÇ   ‚îú‚îÄ‚îÄ environments/             # Configurations d'environnement (dev, prod)
‚îÇ   ‚îú‚îÄ‚îÄ styles.css                # Styles globaux de l'application
‚îÇ   ‚îî‚îÄ‚îÄ main.ts                   # Point d'entr√©e de l'application Angular
‚îî‚îÄ‚îÄ ... (autres fichiers de configuration Angular)
```

### D√©marrage du Frontend
Assurez-vous d'avoir Node.js, npm et Angular CLI install√©s (voir [Pr√©requis](#pr√©requis)).

1.  **Naviguer vers le r√©pertoire frontend**
    ```bash
    cd frontend
    ```
2.  **Installer les d√©pendances**
    ```bash
    npm install
    ```
3.  **D√©marrer le serveur de d√©veloppement**
    ```bash
    ng serve --open
    ```
    L'application sera accessible √† `http://localhost:4200`. Elle se connectera automatiquement au Gateway Service sur `https://localhost:8443`.

### Configuration Sp√©cifique
- **API Endpoint**: Le frontend est configur√© pour communiquer avec le Gateway Service sur `https://localhost:8443`. Cette URL est d√©finie dans `frontend/src/app/services/api-url-service.ts` et devrait √™tre remplac√©e par une URL de production via les fichiers d'environnement (`environments/environment.prod.ts`) pour les d√©ploiements en production.
- **Gestion des Images**: Les images d'avatar et de produits sont g√©r√©es via le Media Service. Les chemins d'acc√®s aux images sont construits dynamiquement.

## üö¶ Status des Services

| Service | Status | Port | Health Check | Swagger |
|---------|--------|------|--------------|---------|
| Discovery Server | ‚úÖ | 8761 | http://localhost:8761 | ‚ùå |
| Gateway Service | ‚úÖ | 8443 | https://localhost:8443 | ‚úÖ Centralis√© |
| User Service | ‚úÖ | 8081 | http://localhost:8081/actuator/health | http://localhost:8081/swagger-ui.html |
| Product Service | ‚úÖ | 8082 | http://localhost:8082/actuator/health | http://localhost:8082/swagger-ui.html |
| Media Service | ‚úÖ | 8083 | http://localhost:8083/actuator/health | http://localhost:8083/swagger-ui.html |
| Frontend | ‚úÖ | 4200 | http://localhost:4200 | ‚ùå |

## üìÅ Structure des volumes

```
./uploads/                    # Volume partag√©
‚îú‚îÄ‚îÄ avatars/                  # User Service - Avatars utilisateurs
‚îî‚îÄ‚îÄ productsImages/           # Media Service - Images produits
```

**Auteur** : [preydedy](https://learn.zone01dakar.sn/git/preydedy/) et [cheikhmodiouf](https://learn.zone01dakar.sn/git/cheikhmodiouf/)

**Version** : 1.0.0  
**Spring Boot** : 3.5.3  
**Spring Cloud** : 2025.0.0  
**Derni√®re mise √† jour** : Juillet 2025